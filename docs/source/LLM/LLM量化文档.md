# LLM量化文档
swift使用awq技术对模型进行量化. 该量化技术支持vllm进行加速推理. 使用VLLM对awq量化模型进行加速推理可以查看[]().


## 目录
- [环境准备](#环境准备)
- [原始模型](#原始模型)
- [微调后模型](#微调后模型)

## 环境准备
GPU设备: A10, 3090, V100, A100均可.
```bash
# 设置pip全局镜像 (加速下载)
pip config set global.index-url https://mirrors.aliyun.com/pypi/simple/
# 安装ms-swift
git clone https://github.com/modelscope/swift.git
cd swift
pip install -e .[llm]

# autoawq和cuda版本有对应关系，请按照`https://github.com/casper-hansen/AutoAWQ`选择版本
pip install autoawq -U

# 环境对齐 (通常不需要运行. 如果你运行错误, 可以跑下面的代码, 仓库使用最新环境测试)
pip install -r requirements/framework.txt  -U
pip install -r requirements/llm.txt  -U
```

## 原始模型
这里展示对qwen1half-7b-chat进行awq量化.
```bash
# awq-int4量化
CUDA_VISIBLE_DEVICES=0 swift export --model_type qwen1half-7b-chat --quant_bits 4
# 推理 swift量化产生的模型
CUDA_VISIBLE_DEVICES=0 swift infer --model_type qwen1half-7b-chat --model_id_or_path qwen1half-7b-chat-int4
# 推理 qwen官方量化的模型: qwen/Qwen1.5-7B-Chat-AWQ
CUDA_VISIBLE_DEVICES=0 swift infer --model_type qwen1half-7b-chat --model_id_or_path qwen/Qwen1.5-7B-Chat-AWQ
```

效果区别:
```python
# 使用swift量化的效果.
"""
<<< 你好
你好！有什么问题我可以帮助你吗？
--------------------------------------------------
<<< 浙江的省会在哪
浙江省的省会是杭州市。
--------------------------------------------------
<<< 这有什么好玩的
浙江有很多好玩的地方，具体好玩取决于你的兴趣爱好。以下是一些推荐：

1. **杭州**：西湖美景、宋城千古情、灵隐寺、乌镇古镇等都是旅游热门，还有阿里巴巴的总部所在地，可以了解现代科技与传统文化的融合。

2. **西湖文化**：西湖十景、龙井茶园品茶、宋城千古情表演等都是文化体验。

3. **浙东大峡谷**：自然风光秀美，适合户外探险和徒步。

4. **乌镇、西塘**：水乡古镇，可以体验江南水乡的生活和建筑。

5. **千岛湖**：湖光山色，适合度假休闲。

6. **宁波天一阁**：中国现存最早的私家藏书楼，历史文化气息浓厚。

7. **绍兴鲁迅故里**：了解鲁迅的文学世界。

8. **舟山普陀山**：佛教文化圣地，可拜佛祈福。

9. **金华双龙洞**：溶洞奇观。

10. **东阳木雕**：传统工艺，可以参观和购买。

如果你对历史、艺术、美食或者户外活动感兴趣，浙江都能提供丰富的选择。记得根据季节和具体活动安排你的行程哦。
"""

# 使用qwen官方量化的效果.
"""
<<< 你好
你好！有什么问题我可以帮助你吗？
--------------------------------------------------
<<< 浙江的省会在哪
浙江省的省会是杭州市。
--------------------------------------------------
<<< 这有什么好玩的
浙江有很多好玩的地方，具体好玩取决于你的兴趣爱好。以下是一些推荐：

1. **杭州**：西湖美景、宋城千古情、灵隐寺、乌镇古镇等都是旅游热门，还有阿里巴巴的总部所在地，可以了解现代科技与传统文化的融合。

2. **西湖文化**：西湖十景、龙井茶园品茶、宋城千古情表演等都是文化体验。

3. **浙东大峡谷**：自然风光秀美，适合户外探险和徒步。

4. **乌镇、西塘**：水乡古镇，可以体验江南水乡的生活和建筑。

5. **千岛湖**：湖光山色，适合度假休闲。

6. **宁波天一阁**：中国现存最早的私家藏书楼，历史文化气息浓厚。

7. **绍兴鲁迅故里**：了解鲁迅的文学世界。

8. **舟山普陀山**：佛教文化圣地，可拜佛祈福。

9. **金华双龙洞**：溶洞奇观。

10. **东阳木雕**：传统工艺，可以参观和购买。

如果你对历史、艺术、美食或者户外活动感兴趣，浙江都能提供丰富的选择。记得根据季节和具体活动安排你的行程哦。
"""
```


## 微调后模型
